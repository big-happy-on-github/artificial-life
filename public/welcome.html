<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIAMLAND</title>
    <link rel="stylesheet" href="css/styles.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9556203064620862"
     crossorigin="anonymous"></script>
    <meta name="google-adsense-account" content="ca-pub-9556203064620862">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <header>
        <a href="/welcome"><h1>LIAMLAND</h1></a>
        <div id="menu">
            <a href="/updates"><p>updates</p></a>
            <a href="/about"><p>about me</p></a>
            <a href="/shop"><p>shop</p></a>
        </div>
        <div class="feedback-container">
            <label for="feedbackInput">got feedback?: </label>
            <input id="feedbackInput">
            <button onclick="addData(document.getElementById('feedbackInput').value)">send</button>
        </div>
    </header>
    <div id="limbucks">loading</div>
    <main>
        <div>
            <img id="wheelImg" width="400" height="375">
            <p id="wheelP">Daily Wheel</p>
            <button id="wheelButton">loading</button>
        </div>
        <div>
            <img id="liamstdImg" width="400" height="375">
            <p id="liamstdP">LiamsTD</p>
            <button id="liamstdButton">loading</button>
        </div>
        <div>
            <img id="chatImg" width="400" height="375">
            <p id="chatP">Liam's Chat</p>
            <button id="chatButton">loading</button>
        </div>
        <div>
            <img id="shadowboxingImg" width="400" height="375">
            <p id="shadowboxingP">Shadowboxing</p>
            <button id="shadowboxingButton">loading</button>
        </div>
        <div>
            <img id="supertagImg" width="400" height="375">
            <p id="supertagP">Supertag</p>
            <button id="supertagButton">loading</button>
        </div>
        <div>
            <img id="adminImg" width="400" height="375">
            <p id="adminP">Admin Menu</p>
            <button id="adminButton">loading</button>
        </div>
    </main>
    <script type="module" src="/js/liamland.js"></script>
    <script type="module">
        // Initialize Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        const response1 = await fetch(`/.netlify/functions/well-kept?name=supabaseUrl`, { mode: 'no-cors' });
        const supabaseUrl = JSON.parse(await response1.text());
        const response2 = await fetch(`/.netlify/functions/well-kept?name=supabaseKey`, { mode: 'no-cors' });
        const supabaseKey = JSON.parse(await response2.text());
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Check if there is a row with project_name 'liamstd'
        const { data, error: selectError } = await supabase
            .from('visits')
            .select('*')
            .eq('project_name', 'liamstd');
        
        // Handle any select errors
        if (selectError) {
            throw selectError;
        }

        console.log(data);

        document.getElementById("liamstdP").textContent += ` (${data[0].num_visits} visits)`;
    </script>
    <script type="module">
        // Initialize Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        const response1 = await fetch(`/.netlify/functions/well-kept?name=supabaseUrl`, { mode: 'no-cors' });
        const supabaseUrl = JSON.parse(await response1.text());
        const response2 = await fetch(`/.netlify/functions/well-kept?name=supabaseKey`, { mode: 'no-cors' });
        const supabaseKey = JSON.parse(await response2.text());
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        const { data, error: selectError } = await supabase
            .from('visits')
            .select('*')
            .eq('project_name', 'chat');

        document.getElementById("chatP").textContent += ` (${data[0].num_visits} visits)`;
    </script>
    <script type="module">
        // Initialize Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        const response1 = await fetch(`/.netlify/functions/well-kept?name=supabaseUrl`, { mode: 'no-cors' });
        const supabaseUrl = JSON.parse(await response1.text());
        const response2 = await fetch(`/.netlify/functions/well-kept?name=supabaseKey`, { mode: 'no-cors' });
        const supabaseKey = JSON.parse(await response2.text());
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        const { data, error: selectError } = await supabase
            .from('visits')
            .select('*')
            .eq('project_name', 'wheel');

        document.getElementById("wheelP").textContent += ` (${data[0].num_visits} visits)`;
    </script>
    <script type="module">
        // Initialize Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        const response1 = await fetch(`/.netlify/functions/well-kept?name=supabaseUrl`, { mode: 'no-cors' });
        const supabaseUrl = JSON.parse(await response1.text());
        const response2 = await fetch(`/.netlify/functions/well-kept?name=supabaseKey`, { mode: 'no-cors' });
        const supabaseKey = JSON.parse(await response2.text());
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        const { data, error: selectError } = await supabase
            .from('visits')
            .select('*')
            .eq('project_name', 'shadowboxing');

        document.getElementById("shadowboxingP").textContent += ` (${data[0].num_visits} visits)`;
    </script>
    <script type="module">
        // Initialize Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        const response1 = await fetch(`/.netlify/functions/well-kept?name=supabaseUrl`, { mode: 'no-cors' });
        const supabaseUrl = JSON.parse(await response1.text());
        const response2 = await fetch(`/.netlify/functions/well-kept?name=supabaseKey`, { mode: 'no-cors' });
        const supabaseKey = JSON.parse(await response2.text());
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        const { data, error: selectError } = await supabase
            .from('visits')
            .select('*')
            .eq('project_name', 'supertag');

        document.getElementById("supertagP").textContent += ` (${data[0].num_visits} visits)`;
    </script>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    
        const response1 = await fetch(`/.netlify/functions/well-kept?name=supabaseUrl`, { mode: 'no-cors' });
        const supabaseUrl = JSON.parse(await response1.text());
        const response2 = await fetch(`/.netlify/functions/well-kept?name=supabaseKey`, { mode: 'no-cors' });
        const supabaseKey = JSON.parse(await response2.text());
        const supabase = createClient(supabaseUrl, supabaseKey);
    
        const keysPressed = {};
    
        // Function to check if there are any alerts for the current user
        async function checkUserAlerts(userID) {
            const { data, error } = await supabase
                .from('admin')
                .select('info')
                .or(`userID.eq.${userID},userID.is.null`) // Fetch both user-specific and global alerts
                .eq('name', 'alert');
        
            if (error) {
                console.error('Error fetching alerts:', error.message);
                return null;
            }
    
            return data ? data.map(alert => alert.info) : [];
        }
    
        let userID = localStorage.getItem("userID"); // Get the userID from localStorage
        let userAlerts = await checkUserAlerts(userID);
        const response = await fetch(`/.netlify/functions/well-kept?name=mainPass`, { mode: 'no-cors' });
        const mainPassword = JSON.parse(await response.text());
    
        document.addEventListener('keydown', async function (event) {
            keysPressed[event.key] = true;
    
            if (keysPressed['Control'] && keysPressed['l'] && keysPressed['b']) {
                alert("ooh, so I see you know the command...");
                const password = prompt("...but do you know the password?");
    
                if (password == mainPassword) {
                    alert("ahh, ok");
                    const command = prompt("what would you like to do?");
    
                    if (command.toLowerCase() === "alert") {
                        const newAlert = prompt("What should the alert say?");
                        if (newAlert) {
                            const sendToAll = confirm("Send this alert to everyone?");
    
                            if (sendToAll) {
                                const { error } = await supabase
                                    .from('admin')
                                    .insert([{ name: 'alert', info: newAlert, userID: null }]); // Null means global alert
    
                                if (!error) {
                                    alert('New global alert set successfully.');
                                    userAlerts.push(newAlert);
                                } else {
                                    alert('Failed to set new global alert.');
                                }
                            } else {
                                const targetUserID = prompt("Enter the userID to alert:");
                                if (targetUserID) {
                                    const { error } = await supabase
                                        .from('admin')
                                        .insert([{ name: 'alert', info: newAlert, userID: targetUserID }]); // Store the alert for specific user
    
                                    if (!error) {
                                        alert('New user-specific alert set successfully.');
                                        userAlerts.push(newAlert);
                                    } else {
                                        alert('Failed to set user-specific alert.');
                                    }
                                }
                            }
                        }
                    }
                } else {
                    alert("a fake!");
                }
            }
        });
    
        document.addEventListener('keyup', function (event) {
            delete keysPressed[event.key];
        });

        const localAlerts = JSON.parse(localStorage.getItem("alert")) || []; // Initialize as empty array if null

        if (userAlerts.length > 0) {
            userAlerts.forEach(alertMessage => {
                // Check if alertMessage is not already in localAlerts
                if (!localAlerts.includes(alertMessage)) {
                    alert(alertMessage); // Show the alert if it's new
                }
            });
            
            // After showing all new alerts, update localStorage
            localStorage.setItem("alert", JSON.stringify(userAlerts));
        }
    </script>
    <script type="module">
        async function loadScreenshots() {
            const domain = window.location.origin; // Get the domain including the protocol
        
            const wheelScreenshot = `https://image.thum.io/get/fullpage/${window.location.origin}/projects/wheel`;
            const liamstdScreenshot = `https://image.thum.io/get/fullpage/${window.location.origin}/projects/liamstd`;
            const chatScreenshot = `https://image.thum.io/get/fullpage/${window.location.origin}/projects/chat`;
            const adminScreenshot = `https://image.thum.io/get/fullpage/${window.location.origin}/projects/admin`;
            const shadowboxingScreenshot = `https://image.thum.io/get/fullpage/${window.location.origin}/projects/shadowboxing`;
            const supertagScreenshot = `https://image.thum.io/get/fullpage/${window.location.origin}/projects/supertag`;

            document.getElementById('wheelImg').src = wheelScreenshot;
            document.getElementById('shadowboxingImg').src = shadowboxingScreenshot;
            document.getElementById('liamstdImg').src = liamstdScreenshot;
            document.getElementById('chatImg').src = chatScreenshot;
            document.getElementById('adminImg').src = adminScreenshot;
            document.getElementById('supertagImg').src = supertagScreenshot;
        }

        // Load the screenshots on page load
        window.onload = loadScreenshots;
    </script>
</body>
</html>
